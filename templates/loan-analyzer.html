<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Payment Analyzer - FinAnalyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loan_analyzer.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="logo">
                <div class="logo-icon">üìä</div>
                <span>FinAnalyzer</span>
            </a>
            <a href="/" class="back-link">‚Üê Back to Home</a>
        </div>
    </nav>

    <div class="page-header">
        <div class="page-header-content">
            <h1>Loan Payment Analyzer</h1>
            <p>Newton-Raphson numerical method for precise loan calculations</p>
        </div>
    </div>


    <div class="container">
        <div class="card">
            <h3 class="card-title">Loan Parameters</h3>
            <form class="form-grid" id="loanForm">
                <div class="form-group">
                    <label>Principal Amount (Rs)</label>
                    <input type="number" id="principal" placeholder="Enter loan amount" value="0" required>
                </div>
                <div class="form-group">
                    <label>Annual Interest Rate (%)</label>
                    <input type="number" id="interestRate" step="0.1" placeholder="Enter interest rate" value="0" required>
                </div>
                <div class="form-group">
                    <label>Loan Term</label>
                    <input type="number" id="loanTerm" placeholder="Enter duration" value="0" required>
                </div>
                <div class="form-group">
                    <label>Term Unit</label>
                    <select id="termUnit">
                        <option value="years">Years</option>
                        <option value="months">Months</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Compounding Frequency</label>
                    <select id="compounding">
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="annually">Annually</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Numerical Method</label>
                    <select id="method">
                        <option value="newton">Newton-Raphson</option>
                        <option value="secant">Secant Method</option>
                    </select>
                </div>
            </form>

            <div class="button-group">
                <button class="btn btn-primary" onclick="calculatePayment()">Calculate Payment</button>
                <button class="btn btn-secondary" onclick="resetForm()">Reset</button>
                <button class="btn btn-secondary" onclick="toggleAmortization()">Show Amortization</button>
                <button class="btn btn-secondary btn-small" onclick="exportCSV()">Export CSV</button>
            </div>
        </div>

        <div class="card">
            <h3 class="card-title">Calculation Results</h3>
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-label">Monthly Payment</div>
                    <div class="result-value" id="monthlyPayment">Rs 0.00</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Total Interest</div>
                    <div class="result-value" id="totalInterest">Rs 0</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Total Paid</div>
                    <div class="result-value" id="totalPaid">Rs 0</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Iterations</div>
                    <div class="result-value" id="iterations">0</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 class="card-title" id="iterationTitle">Iteration Log</h3>
            <div class="iteration-log" id="iterationLog">
                <div class="iteration-row">Enter loan parameters and click "Calculate Payment" to see iteration details...</div>
            </div>
        </div>

        <div class="card">
            <h3 class="card-title">Loan Balance Over Time</h3>
            <div class="chart-container">
                <canvas id="balanceChart"></canvas>
            </div>
        </div>

        <div class="card" id="amortizationCard" style="display: none;">
            <h3 class="card-title">Amortization Schedule</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Payment</th>
                            <th>Principal</th>
                            <th>Interest</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody id="amortizationBody">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #64748b;">
                                Calculate payment to view amortization schedule
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- here is the entire explanation of methods -->
        <div class="card">
            <div class="method-explanation">
                <h3> Numerical Methods Explanation</h3>
                <p>
                    This proejct and khadijas module has used a numerical root-finding algorithm to solve the loan payment equation. 2 methods  have improved approximations iteratively to find where a function becomes equal  to zero means no more laon is cleared..
                </p>
                
                <h4>1st is Newton Raphson Method</h4>
                <div class="formula">
                    x<sub>n+1</sub> = x<sub>n</sub> - f(x<sub>n</sub>) / f'(x<sub>n</sub>)
                </div>
                <p>
                    <strong>Working: </strong> It uses the function value and also its derivative at each point to generate better approximations. (Requires computing the derivative explicitly).
                </p>
                <p>
                    <strong>Advantages:</strong> its is very fast and when close to solution, typically converges(move toeards root (0) ) in 5-8 iterations.
                </p>
                <p>
                    <strong>Speicial requirements:</strong> It needs derivative f'(x) and one guess too at an initial stage.
                </p>
                
                <h4>2nd id Secant Method</h4>
                <div class="formula">
                    x<sub>n+1</sub> = x<sub>n</sub> - f(x<sub>n</sub>) ¬∑ (x<sub>n</sub> - x<sub>n-1</sub>) / (f(x<sub>n</sub>) - f(x<sub>n-1</sub>))
                </div>
                <p>
                    <strong>Working: </strong> This one approximates the derivative using differences between 2 points. No separate derivative calculation neededin this.
                </p>
                <p>
                    <strong>Advantages:</strong> It doesn't require derivative computation, generally reliable for most loan calculations.
                </p>
                <p>
                    <strong>Speicial requirements:</strong> HEre we need two initial guesses.
                </p>
                
                <h4>Application to Loans</h4>
                <p>
                    For loan calculations, we rearrange the payment equation P = M √ó [(1 - (1+r)^-n) / r] 
                    into the form f(M) = 0, where finding the root gives us the monthly payment M.
                </p>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>¬© 2025 FinAnalyzer - Financial Analysis Tool Using Numerical Methods | Numerical Analysis Project</p>
    </footer>

    <script src="{{ url_for('static', filename='js/loan_analyzer.js') }}"></script>
</body>
</html>