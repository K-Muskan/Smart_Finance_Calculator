<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Trend Analyzer - FinAnalyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="/static/css/stock-analyzer.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="logo">
                <div class="logo-icon">üìä</div>
                <span>FinAnalyzer</span>
            </a>
            <a href="/" class="back-link">‚Üê Back to Home</a>
        </div>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-content">
            <h1>Stock Trend Analyzer</h1>
            <p>Advanced curve fitting and price prediction using numerical methods</p>
        </div>
    </div>

    <div class="container">
        <!-- Input Section -->
        <div class="card">
            <h2>üìä Stock Data Input</h2>

            <form id="stockForm">
                <!-- Basic Info -->
                <div class="form-section">
                    <h3>Basic Information</h3>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="companyName">Company Name</label>
                            <input type="text" id="companyName" value="Apple Inc." required>
                        </div>

                        <div class="input-group">
                            <label for="analysisMethod">Curve Fitting Method</label>
                            <select id="analysisMethod">
                                <option value="auto">Auto-Select (Best Fit)</option>
                                <option value="linear">Linear Curve Fitting</option>
                                <option value="quadratic">Quadratic Polynomial Fitting</option>
                                <option value="cubic">Cubic Polynomial Fitting</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Data Input -->
                <div class="form-section">
                    <h3>Historical Data</h3>
                    
                    <div class="tab-buttons">
                        <button type="button" class="tab-btn active" data-tab="csv">CSV Upload</button>
                        <button type="button" class="tab-btn" data-tab="paste">Paste Data</button>
                    </div>

                    <!-- CSV Upload Tab -->
                    <div class="tab-content active" id="csv-tab">
                        <div class="file-upload" id="fileUpload">
                            <input type="file" id="csvFile" accept=".csv">
                            <p>üìÅ Click to upload CSV file</p>
                            <small style="color: #64748b;">Format: Date,Open,High,Low,Close,Adj Close,Volume</small>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="loadSampleData()" style="margin-top: 15px;">
                            üì• Load Sample Data
                        </button>
                    </div>

                    <!-- Paste Tab -->
                    <div class="tab-content" id="paste-tab">
                        <textarea id="csvData" placeholder="Paste your CSV data here..."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" id="analyzeBtn">
                    <span>üöÄ</span> Analyze Stock Trend
                </button>

                <div class="error-message" id="errorMessage"></div>
            </form>
        </div>

        <!-- Results Section -->
        <div class="card" id="resultsSection" style="display: none;">
            <h2>üìà Analysis Results</h2>

            <!-- Loading State -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 15px; color: #64748b;">Analyzing stock data...</p>
            </div>

            <!-- Results Content -->
            <div id="resultsContent" style="display: none;">
                <!-- Company Header -->
                <div class="company-header">
                    <h3 id="resultCompanyName"></h3>
                    <div class="method-badges">
                        <span class="method-badge" id="methodBadge"></span>
                        <span class="method-badge auto-badge" id="autoBadge" style="display: none;">AUTO-SELECTED</span>
                    </div>
                </div>

                <!-- Statistics Grid -->
                <div class="summary-grid" id="statsGrid"></div>

                <!-- Curve Fitting Results -->
                <div class="method-info">
                    <h4>üìê Curve Fitting Analysis</h4>
                    <div class="accuracy-display">
                        <span>Model Accuracy (R¬≤):</span>
                        <span id="accuracyValue" class="accuracy-value">-</span>
                    </div>
                    <div class="equation-box">
                        <strong>Fitted Equation:</strong>
                        <code id="equationText">-</code>
                    </div>
                    <div id="trendIndicator" class="trend-badge"></div>
                </div>

                <!-- Results Tabs -->
                <div class="results-tabs">
                    <button class="results-tab active" data-tab="chart">Growth Chart</button>
                    <button class="results-tab" data-tab="predictions">Predictions</button>
                    <button class="results-tab" data-tab="table">Data Table</button>
                    <button class="results-tab" data-tab="comparison">Model Comparison</button>
                </div>

                <!-- Chart Tab -->
                <div class="results-section active" id="chart-section">
                    <div class="chart-container">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>

                <!-- Predictions Tab -->
                <div class="results-section" id="predictions-section">
                    <div class="chart-container">
                        <canvas id="predictionChart"></canvas>
                    </div>
                </div>

                <!-- Table Tab -->
                <div class="results-section" id="table-section">
                    <div class="table-container">
                        <table class="results-table" id="dataTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Actual Price</th>
                                    <th>Fitted Price</th>
                                    <th>Residual</th>
                                    <th>Accuracy</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody"></tbody>
                        </table>
                    </div>
                    <button class="btn btn-success" onclick="exportResults()" style="margin-top: 20px;">
                        <span>üì•</span> Export Results (CSV)
                    </button>
                </div>

                <!-- Comparison Tab -->
                <div class="results-section" id="comparison-section">
                    <div class="comparison-grid" id="comparisonGrid"></div>
                </div>
            </div>
        </div>

        <!-- Root Finding Section -->
        <div class="card" id="rootFindingSection" style="display: none;">
            <h2>üéØ Target Price Finder</h2>
            
            <div class="form-section">
                <h3>Find When Stock Reaches Target</h3>
                <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 10px;">
                    Uses Newton-Raphson method to predict when the stock will reach your target price
                </p>
                <div id="priceRangeHint" style="background: #eff6ff; padding: 12px; border-radius: 8px; margin-bottom: 15px; display: none;">
                    <p style="color: #1e40af; font-size: 0.85rem; margin: 0;">
                        üí° <strong>Current price range:</strong> <span id="priceRangeText"></span>
                    </p>
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label for="targetPrice">Target Price ($)</label>
                        <input type="number" id="targetPrice" step="0.01" placeholder="Enter target price">
                    </div>
                    <button class="btn btn-primary" onclick="findRoot()" style="align-self: flex-end;">
                        <span>üîç</span> Find Target Date
                    </button>
                </div>
            </div>

            <div id="rootFindingResults" style="display: none;">
                <div class="method-info" id="rootResultInfo"></div>
                
                <div class="chart-container" style="margin-top: 25px;">
                    <h4 style="margin-bottom: 15px;">üìâ Convergence Analysis</h4>
                    <canvas id="convergenceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Error Analysis Section -->
        <div class="card" id="errorAnalysisSection" style="display: none;">
            <h2>‚ö†Ô∏è Error Analysis</h2>
            
            <div class="method-info">
                <h4>Truncation Error Analysis</h4>
                <p style="color: #64748b; margin-bottom: 20px;">
                    Measures the error from using a polynomial of limited degree
                </p>
            </div>

            <div class="summary-grid" id="errorStatsGrid"></div>

            <div class="error-explanation" id="errorExplanation"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© 2024 FinAnalyzer - Financial Analysis Tool Using Numerical Methods | Stock Trend Analyzer</p>
    </footer>

    <script src="/static/js/stock-analyzer.js"></script>
</body>
</html>